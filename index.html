<!DOCTYPE html> 
<html style="margin:0px;"> 
<head>
	<title>Budapest Route Planner</title>
	<meta name='viewport' content='width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no' />
	<link rel="stylesheet" href="style/style.css">
	<script src='scripts/maplibre-gl/maplibre-gl.js'></script>
	<link href='scripts/maplibre-gl/maplibre-gl.css' rel='stylesheet' />
	<script type="text/javascript" charset="utf-8" src="scripts/external/turf.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="scripts/external/jszip.min.js"></script>
	<script type="text/javascript" charset="utf-8" src="scripts/gtfs.js"></script>
	<script type="text/javascript" charset="utf-8" src="scripts/style.js"></script>
	<script type="text/javascript" charset="utf-8" src="scripts/local.js"></script>
	<script type="text/javascript" charset="utf-8" src="scripts/menuControl.js"></script>
	<script type="text/javascript" charset="utf-8" src="scripts/route_ui.js"></script>
	<script>
		var map, mapUI, route;
		var gtfs, gtfsRoutes;

		function onLoad()
		{
			map = new maplibregl.Map({
				container: 'map',
				style: style,
				center: [19.06086, 47.52918],
				zoom: 15
			});
			map.addControl(new maplibregl.FullscreenControl({ container: document.querySelector('body') }));
			map.addControl(new maplibregl.NavigationControl());
			map.addControl(new maplibregl.GeolocateControl({
				positionOptions: { enableHighAccuracy: true },
				trackUserLocation: true
			}).on('geolocate', (e) => {
				console.log('geolocate', e);
			}));

			map.addControl(new MenuControl(),'top-left');

			mapUI = new MapUI(map);
			mapUI.addMarkerOnClick();

			route = new Route(mapUI);
			setInterval(function(){
				if(route.source==null){return;}
				route.clearFeatures();
				route.addFeature([
					[19.05499444493165+Math.random()*0.0005-0.00025, 47.52649376411256+Math.random()*0.0005-0.00025],
					[19.063230222910875+Math.random()*0.0005-0.00025, 47.52454046418376+Math.random()*0.0005-0.00025],
					[19.06258690877337+Math.random()*0.0005-0.00025, 47.52289446901065+Math.random()*0.0005-0.00025], 
				  ], {'color':'red'});
				route.addFeature([
					[19.05809131631935, 47.523902263181526],
					[19.057243786593375, 47.52230969067739]
				  ], {'color':'#00ff00', 'width':20});
				route.commitChanges();
			}, 1000);
		}
	</script>
</head>
	<body onload="onLoad();"> 
		<div id="map"></div>
		<pre id="coordinates"></pre>
	</body>
</html>